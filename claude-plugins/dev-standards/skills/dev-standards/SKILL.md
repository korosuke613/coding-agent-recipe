---
name: dev-standards
description: プロジェクトの開発ルール遵守をチェックし、違反を報告・修正する。TypeScriptでのany禁止、CI品質チェック必須、ローカル動作確認、conventional commit採用、依存バージョン固定のルールを適用。コード作成・編集後、コミット前、PRレビュー時に使用。`/dev-standards`で明示的にチェック、`--fix`で自動修正を実行。
---

# 開発ルール遵守チェックスキル

このスキルは、プロジェクトで重要な5つの開発ルールが適切に守られているかをチェックし、違反を発見・報告・修正します。

## 実行方法

### 基本的な使用方法

```
/dev-standards
```

プロジェクト全体の開発ルール遵守状況をチェックし、レポートを生成します。

### オプション

- `--fix` - 自動修正可能な違反を修正提案として表示
- `--typescript` - TypeScript関連のルールのみチェック
- `--ci` - CI/CD関連のルールのみチェック
- `--dependencies` - 依存関係管理のルールのみチェック
- `--commit` - コミット規約のルールのみチェック
- `--local-test` - ローカルテスト実行環境のルールのみチェック
- 引数にファイルパスを指定 - 特定のファイルのみをチェック

### 使用例

```bash
# プロジェクト全体をチェック
/dev-standards

# TypeScriptファイルのanyのみチェック
/dev-standards --typescript

# 自動修正提案を表示
/dev-standards --fix

# 特定のファイルをチェック
/dev-standards src/utils/api.ts
```

## チェックされる5つの開発ルール

### 1. TypeScriptにおいてanyは使わない

**目的**: 型安全性を確保し、バグを事前に防止する

**チェック内容**:
- `.ts`, `.tsx` ファイル内の `any` 使用を検出
- `any[]`, `Promise<any>`, `Record<string, any>` なども対象
- `// @ts-ignore`, `// @ts-expect-error` の使用も確認

**修正提案**:
- `unknown` への置き換え
- ジェネリクス型の使用
- 適切な型定義の作成
- 型ガードの使用

### 2. 必ずCIで品質チェックを行うようにする

**目的**: コード品質を自動的に担保し、チーム全体の開発効率を向上

**チェック内容**:
- `.github/workflows/` または `.gitlab-ci.yml` などのCI設定ファイルの存在確認
- CI設定内での品質チェック実行の確認（lint, test, type-check など）
- プルリクエスト/マージリクエストでの必須チェックの設定確認

**推奨される品質チェック**:
- リント（ESLint, Prettier など）
- テスト実行（Jest, Vitest など）
- 型チェック（TypeScript）
- ビルドの成功確認

### 3. デプロイ前にローカルで実行して動作確認できるようにする

**目的**: 本番環境への影響を最小限にし、デプロイの安全性を向上

**チェック内容**:
- `package.json` の `scripts` セクションでのローカル実行スクリプトの確認
  - `dev`, `start`, `serve` などの開発サーバー起動コマンド
  - `build` や `preview` などのビルド・プレビューコマンド
- Docker Compose や devcontainer などのローカル実行環境設定の確認
- README.md でのローカル実行手順の記載確認

**推奨される設定**:
- `npm run dev` または `yarn dev` でローカル開発サーバーを起動できる
- `npm run build && npm run preview` で本番ビルドをローカルで確認できる
- ドキュメントにローカル実行手順が明記されている

### 4. 原則としてconventional commitを採用する

**目的**: コミット履歴を整理し、変更履歴の理解とリリースノート生成を容易にする

**チェック内容**:
- 直近のコミットメッセージが Conventional Commit 形式に従っているか確認
- プレフィックス（`feat:`, `fix:`, `docs:`, `chore:` など）の使用確認
- コミットメッセージの構造確認（type, scope, description）

**Conventional Commit の形式**:
```
<type>[optional scope]: <description>

[optional body]

[optional footer(s)]
```

**主な type**:
- `feat`: 新機能の追加
- `fix`: バグ修正
- `docs`: ドキュメントのみの変更
- `style`: コードの動作に影響しない変更（フォーマット、セミコロンなど）
- `refactor`: バグ修正や機能追加を含まないコード変更
- `perf`: パフォーマンス改善
- `test`: テストの追加や修正
- `chore`: ビルドプロセスやツールの変更

### 5. 依存ライブラリのバージョンは固定する

**目的**: 再現性を確保し、予期しないバージョンアップによる問題を防止

**チェック内容**:
- `package.json` での依存関係のバージョン指定方法の確認
  - `^` (キャレット) や `~` (チルダ) を使用していないか
  - 具体的なバージョン番号が指定されているか
- `package-lock.json`, `yarn.lock`, `pnpm-lock.yaml` などのロックファイルの存在確認
- `Dockerfile` や他の設定ファイルでのバージョン固定確認

**推奨される設定**:
```json
{
  "dependencies": {
    "react": "18.2.0",      // ✅ 固定バージョン
    "vue": "^3.3.4"         // ❌ キャレットは非推奨
  }
}
```

## レポート出力フォーマット

チェック実行後、以下の形式でレポートを出力します：

```markdown
# 開発ルール遵守チェックレポート

## チェック結果サマリー
- ✅ 合格: 3項目
- ⚠️ 警告: 1項目
- ❌ 不合格: 1項目

## 詳細

### ❌ 1. TypeScriptにおいてanyは使わない
**ステータス**: 不合格
**違反箇所**: 3件

- `src/utils/api.ts:15` - `any` の使用を検出
- `src/components/Form.tsx:42` - `Record<string, any>` の使用を検出
- `src/hooks/useData.ts:8` - `Promise<any>` の使用を検出

**修正提案**:
- `src/utils/api.ts:15` - `unknown` または適切な型定義を使用してください
- `src/components/Form.tsx:42` - `Record<string, FormValue>` のような具体的な型を使用してください
- `src/hooks/useData.ts:8` - 戻り値の型を明示的に定義してください

### ✅ 2. 必ずCIで品質チェックを行うようにする
**ステータス**: 合格
- `.github/workflows/ci.yml` が存在し、lint, test, type-check が設定されています

### ⚠️ 3. デプロイ前にローカルで実行して動作確認できるようにする
**ステータス**: 警告
- `package.json` に `dev` スクリプトは存在しますが、README.md にローカル実行手順の記載がありません

**推奨事項**:
- README.md にローカル実行手順を追加してください

### ✅ 4. 原則としてconventional commitを採用する
**ステータス**: 合格
- 直近10件のコミットがすべて Conventional Commit 形式に従っています

### ✅ 5. 依存ライブラリのバージョンは固定する
**ステータス**: 合格
- `package.json` で全ての依存関係が固定バージョンで指定されています
- `package-lock.json` が存在します
```

## 自動修正モード (`--fix`)

`--fix` オプションを指定すると、自動修正可能な違反について具体的な修正内容を提案します。

**自動修正可能な項目**:

1. **TypeScriptのany使用**
   - 文脈に応じて `unknown`、ジェネリクス、適切な型定義への置き換えを提案

2. **依存関係のバージョン固定**
   - `^` や `~` を削除した固定バージョンへの変更を提案

3. **CI設定の追加**
   - 基本的なCI設定ファイルのテンプレートを提案

**自動修正の実行例**:

```bash
/dev-standards --fix
```

修正提案を確認後、ユーザーの承認を得てから実際の修正を適用します。

## 実装の流れ

1. **プロジェクト構造の分析**
   - `package.json`, `tsconfig.json`, `.github/workflows/`, `README.md` などの存在確認
   - プロジェクトタイプの判定（Node.js, TypeScript, フレームワークなど）

2. **各ルールのチェック実行**
   - ファイル検索（Glob）とコンテンツ検索（Grep）を使用
   - 設定ファイルの読み込みと解析（Read）
   - Git履歴の確認（Bash + git log）

3. **結果の集約とレポート生成**
   - 各ルールのチェック結果を統合
   - 優先度に基づいた並び替え
   - マークダウン形式でのレポート作成

4. **修正提案の生成（`--fix`時）**
   - 自動修正可能な項目の抽出
   - 具体的な修正内容の生成
   - ユーザーへの確認と適用

## 補足資料

より詳細なルールとベストプラクティスについては、以下のリファレンスを参照してください：

- [TypeScript ルール詳細](./references/typescript-rules.md)
- [Conventional Commit 規約詳細](./references/commit-conventions.md)

## 使用タイミング

このスキルは以下のタイミングで使用することを推奨します：

1. **コード作成・編集後**: 新しいコードが開発ルールに準拠しているか確認
2. **コミット前**: コミットメッセージとコード変更の両方をチェック
3. **プルリクエスト作成前**: レビュー前に全体的な品質を確認
4. **定期的なプロジェクトレビュー**: プロジェクト全体の健全性を定期的にチェック
5. **新メンバーのオンボーディング**: 開発ルールの教育と実践

## 注意事項

- このスキルはルール違反を検出しますが、最終的な判断はプロジェクトの状況に応じて行ってください
- プロジェクト固有のルールや例外がある場合は、適宜調整してください
- 自動修正は提案であり、実際の適用前にレビューすることを推奨します
